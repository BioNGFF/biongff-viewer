import{R as C,E as k,b as j,_ as U}from"./index-a31ecffb.js";var b=t=>{throw TypeError(t)},A=(t,e,n)=>e.has(t)||b("Cannot "+n),d=(t,e,n)=>(A(t,e,"read from private field"),n?n.call(t):e.get(t)),w=(t,e,n)=>e.has(t)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),g=(t,e,n,r)=>(A(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);function E(t,e=/{{(.*?)}}/){let n=e.exec(t);const r=[];let s;for(;n;)s=n.index,s!==0&&(r.push({match:!1,str:t.substring(0,s)}),t=t.slice(s)),r.push({match:!0,str:n[0]}),t=t.slice(n[0].length),n=e.exec(t);return t&&r.push({match:!1,str:t}),r}function $(t){const e=t.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(e!=null&&e.groups))return;const{fname:n,args:r}=e.groups,s=Object.fromEntries(r.split(",").map(c=>{var a;const{key:o,num:i,str:f}=((a=c.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:a.groups)??{};if(!o||!(i||f))throw Error(`Failed to match fn kwarg: ${c}`);return[o,i?Number(i):f]}));return{fname:n,ctx:s}}const v="abcdefghijklmnopqrstuvwxyz",z="01234569789",O="()*/+-",S=" ",_=new Set(v+v.toUpperCase()+z+O+S);function M(t){for(let e=0;e<t.length;e++)if(!_.has(t.charAt(e)))return;return E(t,/[A-Za-z_][A-Za-z0-9_]*/gi)}function R(t,e){return E(t).map(n=>{if(!n.match)return n.str;let r=n.str.split(/{{|}}/).filter(Boolean)[0].trim();if(r in e)return e[r];const s=$(r);if(s){const{fname:a,ctx:o}=s,i=e[a];if(typeof i=="function")return i(o);throw Error(`Cannot find function named ${a} in rendering context.`)}const c=M(r);if(c){const a=c.map(o=>{if(!o.match)return o.str;const i=e[o.str];if(i==null)throw Error(`Cannot find number named ${o.str} in rendering context.`);if(typeof i!="number")throw Error(`The provided value for ${o.str} must be a number.`);return i});return Function('"use strict";return ('+a.join("")+")")()}throw new Error(`Unable to match ${n.str}`)}).join("")}function T(t,e=R){return"version"in t?Z(t,e):W(t)}function W(t){return new Map(Object.entries(t))}function Z(t,e){var n;const r={};for(const[a,o]of Object.entries(t.templates??{}))o.includes("{{")?r[a]=i=>e(o,i):r[a]=o;const s=(a,o)=>e(a,{...r,...o}),c=new Map;for(const[a,o]of Object.entries(t.refs??{}))if(typeof o=="string")c.set(a,o);else{const i=(n=o[0])!=null&&n.includes("{{")?s(o[0]):o[0];c.set(a,o.length===1?[i]:[i,o[1],o[2]])}for(const a of t.gen??[])for(const o of I(a.dimensions)){const i=s(a.key,o),f=s(a.url,o);if("offset"in a&&"length"in a){const p=s(a.offset,o),x=s(a.length,o);c.set(i,[f,parseInt(p),parseInt(x)])}else c.set(i,[f])}return c}function*I(t){const e=Object.keys(t),n=Object.values(t).map(r=>Array.isArray(r)?r:[...B(r)]);for(const r of q(...n))yield Object.fromEntries(e.map((s,c)=>[s,r[c]]))}function*q(...t){if(t.length===0)return;const e=t.map(r=>r[Symbol.iterator]()),n=e.map(r=>r.next());if(n.some(r=>r.done))throw new Error("Input contains an empty iterator.");for(let r=0;;){if(n[r].done){if(e[r]=t[r][Symbol.iterator](),n[r]=e[r].next(),++r>=e.length)return}else yield n.map(({value:s})=>s),r=0;n[r]=e[r].next()}}function*B({stop:t,start:e=0,step:n=1}){for(let r=e;r<t;r+=n)yield r}(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var r=n.length,s=new Uint8Array((r-(n[r-1]=="=")-(n[r-2]=="="))*3/4|0),c=0,a=0;c<r;){var o=t[n.charCodeAt(c++)],i=t[n.charCodeAt(c++)],f=t[n.charCodeAt(c++)],p=t[n.charCodeAt(c++)];s[a++]=o<<2|i>>4,s[a++]=i<<4|f>>2,s[a++]=f<<6|p}return s}})();new TextEncoder;let u=new Uint8Array(128);for(let t=0;t<64;t++)u[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;function F(t){const e=t.length,n=new Uint8Array((e-(t[e-1]==="=")-(t[e-2]==="="))*3/4|0);for(let r=0,s=0;r<e;){const c=u[t.charCodeAt(r++)],a=u[t.charCodeAt(r++)],o=u[t.charCodeAt(r++)],i=u[t.charCodeAt(r++)];n[s++]=c<<2|a>>4,n[s++]=a<<4|o>>2,n[s++]=o<<6|i}return n}var l,h,m;const N=class y{constructor(e,n={}){w(this,l),w(this,h),w(this,m),g(this,l,Promise.resolve(e)),g(this,h,n),g(this,m,n.overrides||{})}async get(e,n={}){let r=(await d(this,l)).get(C(e));if(!r)return;if(typeof r=="string")return r.startsWith("base64:")?F(r.slice(7)):new TextEncoder().encode(r);let[s,c,a]=r,o=s??d(this,h).target;if(!o)throw Error(`No url for key ${e}, and no target url provided.`);let i=await k(U(o),c,a,j(d(this,m),n));if(i.status===200||i.status===206)return new Uint8Array(await i.arrayBuffer());throw new Error(`Request unsuccessful for key ${e}. Response status: ${i.status}.`)}static fromSpec(e,n){let r=Promise.resolve(e).then(s=>T(s));return new y(r,n)}static fromUrl(e,n){let r=fetch(e,n==null?void 0:n.overrides).then(s=>s.json());return y.fromSpec(r,n)}};l=new WeakMap,h=new WeakMap,m=new WeakMap;let K=N;export{K as default,F as to_binary};
